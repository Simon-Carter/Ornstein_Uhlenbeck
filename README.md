# Ornstein_Uhlenbeck

## Environment

The project.toml and Manifest.toml are located in the folder OU
  
## Models

### Dataset Generation

Data set generation was handled in the *sample()* method in each of the scripts with suffix *_gen*. The input of the sample function is one of the models and its parameters defined by [model_generation.jl](model_generation.jl)  in the root directory. The methodology behind these models is explained below.

#### Ornstein_Uhlenbeck Models

These make use of the [DifferenetialEquations.jl](https://github.com/SciML/DifferentialEquations.jl) package to simulate an Ornstein Uhlenbeck process. This equation uses the differential equation form $dx_t = -\theta(\mu - x_t) dt + \sigma dW_t$.

  
  

In the code we reference the process in terms of the Fokker-Planck equation representation (representing the process in terms of a probability density function). Given the markovian nature of the OU process, we can view the process as,

  
  

$P(x,t | x', t') = \sqrt{\frac{\theta}{2\pi D(1-e^{-2\theta (t-t')})}}\exp{\left[ - \frac{\theta}{2D} \frac{\left( x-x'e^{-\theta (t - t')}\right)^2}{1-e^{-2\theta (t-t')}}\right]}$ where $D = \frac{\sigma^2}{2}$

  

We refer to Amplitude(*Amp*) as $\frac{D}{\theta}$ (the variance of the guassian as $(t - t') \rightarrow  \infty$ ), and $\tau$(*tau*) as $\frac{1}{\theta}$

  

#### Noise

  

In addition to the Ornsein Uhlenbeck process we also generate additional Gaussian noise. Here we have two types, Thermal and Multiplicative. The thermal noise is sampled from a Gaussian distribution with variance *Tnoise*. The multiplicative noise is generated as a Gaussian centered about zero, and its variance proportional to the signal. These noises are then summed with the generated Ornstein Uhlenbeck trajectory to generate the final signal.

Mixed noise is a combination of both. We define a ratio to dictate the relative thermal to multiplicative noise as the ratio of the variance between the thermal and multiplicative signal. Since the multiplicative noise is dimensionless, to make the ratio dimensionless, we multiply the multiplicative noise by the variance of the OU signal.

### Parameter Prediction

  

The Probabilistic models and sampling were done using [Turing.jl](https://github.com/TuringLang/Turing.jl)

  

#### Turing Model

  

Two different models where created using the Turing interface assuming different types of noise. We treat the Ornstein-Uhlenbeck parameters as well as the amplitudes of the noise as parameters to be fit

  

##### Thermal Model

The thermal model is labeled as *oupn_thermal*, and simply assumes additive Gaussian noise, whose STD is T_noise. The data generated from this model was done so by the *./scripts/thermal_gen.jl* file

  

##### Mixed Model

 
The mixed model also assumes the same format as the thermal model, but with the addition of Gaussian noise whose variance depends on the magnitude of the signal. This is labeled as *oupn_mt*, and assumes that the ratio to thermal and multiplicative noise is known. Since the thermal and multiplicative noises are assumed to be Gaussian and independent, we can treat the total noise as a Gaussian with the appropriate variance.

#### Posterior Sampling

The posterior is sampled using the sample method provided by Turing.jl. The specifics of the sampling can be tweaked on a script by script basis, as can be seen with the files suffixed by *_gen.jl*

  

## Data

 For the included scripts that data was initially generated as a *JLD2* file and then parsed to *.CSV* for easier plotting.

### CSV format

Each csv file is formatted in columns with labels as the first row. If there is a number at the end of the label, then that corresponds to multiple different simulations measuring the same value, with each number labeling the specifics simulation.

### Files


#### Mixed_course.csv

20 different simulations where run each containing 1500 points of data. The mixed Gaussian model was used with a ratio of 1 and a thermal noise of 0.2. The varying parameter was the ratio of sample rate to time constant, $\frac{\Delta t}{\tau}$, using 0:0.1:2. The posterior was sampled using markov chain monte carlo using a NUTS sampler at 0.65 for 1000 iterations.

  

#### Mixed_fine.csv

##### Data generated by [mixed_fine_gen.jl](Scripts/mixed_fine_gen.jl) and Parsed by [mixed_fine_parse.jl](Scripts/mixed_fine_parse.jl)


A single simulation was run where each containing 1500 points of data. The mixed Gaussian model was used with a ratio of 1 and a thermal noise of 0.2. The varying parameter was the ratio of sample rate to time constant, $\frac{\Delta t}{\tau}$, using 0:0.005:1. The posterior was sampled using HMC using a NUTS sampler at 0.65 for 1000 iterations.

  

#### Mixed_many.csv

##### Data generated by [mixed_many_gen.jl](Scripts/mixed_many_gen.jl) and Parsed by [mixed_many_gen.jl](Scripts/mixed_many_parse.jl)


20 simulations were run where each containing 1500 points of data. The Mixed Gaussian model was used with a ratio of 1 and a thermal noise of 0.2. The varying parameter was the ratio of sample rate to time constant, $\frac{\Delta t}{\tau}$, using 0.05:0.05:1. The posterior was sampled using HMC using a NUTS sampler at 0.65 for 1000 iterations.

 
#### Thermal.csv

##### Data generated by [thermal_gen.jl](Scripts/thermal_gen.jl) and Parsed by [thermal_gen.jl](Scripts/thermal_parse.jl)

A single simulation was run where each containing 1500 points of data. The Thermal model was used with a ratio of 1 and a thermal noise of 0.2. The varying parameter was the ratio of sample rate to time constant, $\frac{\Delta t}{\tau}$, using 0:0.005:1. The posterior was sampled using HMC using a NUTS sampler at 0.65 for 1000 iterations.

  

#### Mixed_ratio.csv

##### Data generated by [mixed_ratio_gen.jl](Scripts/mixed_ratio_gen.jl) and Parsed by [mixed_ratio_gen.jl](Scripts/mixed_ratio_parse.jl)

  

A single simulation was run where each containing 1500 points of data. The Mixed model was used with a $\frac{\Delta t}{\tau} = 0.5$. The ratio of mixed to thermal noise was varied by 0.1:0.1:5. The thermal noise was calculated such that the summation of the thermal and multiplicative noise amounted to 0.2. The posterior was sampled using HMC using a NUTS sampler at 0.65 for 1000 iterations.

## Additional included Scripts

### Additional plotting

[Plotting.jl](Scripts/Plotting.jl) - Produces the plots that where included in the accompanying paper. The mixed_ratio data was created by using different sampling rates in [mixed_ratio_gen.jl](Scripts/mixed_ratio_gen.jl), and EMdata.csv and MCMCmean.csv where generated from the python scripts mention in the first section of our paper.

[Amplitude_fir_plotting.jl](Scripts/Amplitude_fit_plotting.jl) - Self contained script demonstrating the power spectra of OU process with and without noise


### Future implementation
[nifti_parse.jl](Scripts/nifti.jl)
[corr.jl](Scripts/corr.jl)
